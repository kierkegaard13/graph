var ui=function(){"use strict";var e=$(".graph_cont").width(),t=$(".graph_cont").height(),n=20,r=25,i=d3.scale.category20(),s=1e3,o=0,u,a,f=function(s){var u,a,f,l,c,h,p,d=[],v=[],m=[],g=[],y={},b=0,w=-1,E=0,S=0,x=this,T=function(){p.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")},N=d3.behavior.zoom().scaleExtent([.1,2]).on("zoom",T);this.inspectNodes=function(){return m},this.inspectLinks=function(){return g},this.constructForceLayout=function(n){$("svg").remove(),n=typeof n=="undefined"?1:n,c=d3.layout.force().charge(-6e3).linkDistance(200*n).linkStrength(.2).size([e,t]).links(g).nodes(m).on("tick",this.tick),h=d3.select(".graph_cont").append("svg").attr("width",e).attr("height",t).call(N).on("dblclick.zoom",null),p=h.append("g")},this.clearNodes=function(e){m=[],g=[],this.constructForceLayout(e)},this.refreshNodes=function(){$.each(m,function(e,t){t.fixed=!0})},this.neighboring=function(e,t){return console.log(e,t),e===t||y[e+"-"+t]},this.buildLinks=function(e){var t,n;t=parseInt($("#min_w").val()),n=parseInt($("#max_w").val()),v=[];for(var r=0;r<m.length;r++)v.push([]);switch(e){case"tree":var i,s,o=[],u=[];for(var r=1;r<m.length;r++)o.push(m[r]);u.push(m[0]);while(o.length!==0){i=Math.floor(Math.random()*5+1);for(var r=0;r<i;r++){if(!(o.length>0))break;s=Math.floor(Math.random()*(o.length-1)),g.push({source:m[u[0].id],target:m[o[s].id],type:0,weight:Math.floor(Math.random()*n+t)}),v[u[0].id].push(o[s].id),v[o[s].id].push(u[0].id),u.push(o[s]),o.splice(s,1)}u.shift()}break;case"btree":var s,o=[],u=[];for(var r=1;r<m.length;r++)o.push(m[r]);u.push(m[0]);while(o.length!==0){for(var r=0;r<2;r++){if(!(o.length>0))break;s=Math.floor(Math.random()*(o.length-1)),g.push({source:m[u[0].id],target:m[o[s].id],type:0,weight:Math.floor(Math.random()*n+t)}),v[u[0].id].push(o[s].id),v[o[s].id].push(u[0].id),u.push(o[s]),o.splice(s,1)}u.shift()}break;case"sparse":var a,s,f,l,c,h,p,o=[],d;p=m.length,h=Math.floor(Math.random()*(p*(p-1)/4-1-p)+p),c=Math.ceil(h/p),a=h%p;for(var r=0;r<m.length;r++)o.push(m[r]);while(o.length!==0){l=Math.floor(Math.random()*(o.length-1)),f=o[l],o.splice(l,1),d=[];for(var r=0;r<p;r++)v[r].indexOf(f.id)===-1&&d.push(m[r]);for(var r=0;r<c;r++){if(!(d.length>0))break;s=Math.floor(Math.random()*(d.length-1)),g.push({source:m[f.id],target:d[s],type:0,weight:Math.floor(Math.random()*n+t)}),v[f.id].push(d[s].id),v[d[s].id].push(f.id),d.splice(s,1),a--,a==0&&(c--,a=h)}}break;case"dense":var a,s,f,l,c,h,p,o=[],d;p=m.length,h=Math.floor(Math.random()*(p*(p-1)/4-1-p)+p+p*(p-1)/4),c=Math.ceil(h/p),a=h%p;for(var r=0;r<p;r++)o.push(m[r]);while(o.length!==0){l=Math.floor(Math.random()*(o.length-1)),f=o[l],o.splice(l,1),d=[];for(var r=0;r<p;r++)v[r].indexOf(f.id)===-1&&d.push(m[r]);for(var r=0;r<c;r++){if(!(d.length>0))break;s=Math.floor(Math.random()*(d.length-1)),g.push({source:m[f.id],target:d[s],type:0,weight:Math.floor(Math.random()*n+t)}),v[f.id].push(d[s].id),v[d[s].id].push(f.id),d.splice(s,1),a--,a==0&&(c--,a=h)}}break;case"full":for(var r=0;r<m.length;r++)for(var b=r+1;b<m.length;b++)g.push({source:m[r],target:m[b],type:0,weight:Math.floor(Math.random()*n+t)}),v[r].push(b),v[b].push(r);break;case"custom":var w,E=parseFloat($("#prob").val());for(var r=0;r<m.length;r++)for(var b=r+1;b<m.length;b++)w=Math.random()<E,w===!0&&(g.push({source:m[r],target:m[b],type:0,weight:Math.floor(Math.random()*n+t)}),v[r].push(b),v[b].push(r));break;case"input":break;default:}$("#graph_data").html(""),$("#graph_data").append("<div>"+m.length+" "+g.length+"</div>"),y={};for(var r=0;r<g.length;r++)y[g[r].source.id+"-"+g[r].target.id]=1,y[g[r].target.id+"-"+g[r].source.id]=1,$("#graph_data").append("<div>"+g[r].source.id+" "+g[r].target.id+" "+g[r].weight+"</div>")},this.buildNodes=function(n,r){var i;w=b,b=0,r==="sparse"?this.clearNodes(2):r==="dense"?this.clearNodes(4):r==="full"?this.clearNodes(8):(n[0].group=1,this.clearNodes());for(var s=0;s<n.length;s++){var o=n[s];o.x=e/2,o.y=t/2,m.push(o)}this.buildLinks(r)},this.buildGraphFromInput=function(){var n,r,i,s=$("#graph_data").html();o=1,s=s.replace(/<\/div>/g,"").split(/<div[\s\w="-:;]*>/),s[0]===""&&s.splice(0,1),n=parseInt(s[0].split(" ")[0]),r=parseInt(s[0].split(" ")[1]),v=[];for(var u=0;u<n;u++)v.push([]);n<50?this.clearNodes():n<100?this.clearNodes(2):n<500?this.clearNodes(4):this.clearNodes(8);for(var u=0;u<n;u++)m.push({id:u,x:e/2,y:t/2});for(var u=1;u<=r;u++)s[u].length>0&&(s[u].trim(),i=s[u].split(" "),i={source:parseInt(i[0]),target:parseInt(i[1]),weight:parseFloat(i[2])},v[i.source].push(i.target),v[i.target].push(i.source),g.push({source:m[i.source],target:m[i.target],type:0,weight:i.weight}),y={},y[i.source+"-"+i.target]=1,y[i.target+"-"+i.source]=1)},this.findEdge=function(e,t){var n=null;e=parseInt(e),t=parseInt(t);for(var r=0;r<g.length;r++){if(g[r].source.id===e&&g[r].target.id===t)return n=g[r],{dom:$("#link_"+e+"_"+t),item:n};if(g[r].source.id===t&&g[r].target.id===e)return n=g[r],{dom:$("#link_"+t+"_"+e),item:n}}return null},this.highlightEdge=function(e,t){var n=$("#link_"+e+"_"+t);n.length===0&&(n=$("#link_"+t+"_"+e)),n.find(".link-line").css("stroke","red")},this.highlightEdges=function(e){var t;for(var n=d.length-1;n>=0;n--)t=this.findEdge(d[n].source,d[n].target),t&&t.dom.find(".link-line").css("stroke",i(t.item.type)),d.pop();for(var n=0;n<e.length;n++)this.highlightEdge(e[n].source,e[n].target),d.push(e[n])},this.algo=function(e){var t=this,n=$("#graph_data").html().replace(/<\/div>/g,"").replace(/\n/g,"").split(/<div[\s\w="-:;]*>/);e==="dijkstra"&&(n[0]!==""?n[0]=n[0]+" "+$("#start").val()+" "+$("#end").val():n[1]=n[1]+" "+$("#start").val()+" "+$("#end").val()),console.log(n),n={name:e,data:n},$.ajax({url:window.location.href.split("/")[0]+"/algo/",data:n}).done(function(n){console.log(n);var r,i="<div>",s="</div>";r=n,n=n.join("</div><div>"),i=i.concat(n,s);for(var o=0;o<r.length;o++)r[o].trim(),r[o]={source:r[o].split(" ")[0],target:r[o].split(" ")[1]};e!=="dijkstra"&&t.highlightEdges(r),$("#highlight_edges").html(i)})},this.refreshGraph=function(){u=p.selectAll(".link").data(c.links()).enter().append("g").attr("class","link").attr("id",function(e){return"link_"+e.source.id+"_"+e.target.id}).append("line").attr("class","link-line").attr("stroke-width",3).style("stroke",function(e){return i(e.type)}).call(c.drag),a=p.selectAll(".link").append("text").attr("class","link-label").attr("font-family","Arial, Helvetica, sans-serif").attr("fill","Black").style("font","normal 18px Arial").attr("dy",".35em").attr("text-anchor","middle").text(function(e){return e.weight}),l=p.selectAll(".node").data(c.nodes()).enter().append("g").attr("class","node").on("mouseover",function(e){p.selectAll("#node_"+e.id).transition().duration(500).attr("r",r),p.selectAll(".node").transition().duration(500).attr("opacity",function(t){return x.neighboring(e.id,t.id)?1:.3}),p.selectAll(".link-line").transition().duration(500).attr("opacity",function(t){return t.source.id==e.id||t.target.id==e.id?1:.3})}).on("mouseout",function(e){p.selectAll("#node_"+e.id).transition().duration(500).attr("r",n),p.selectAll(".node").transition().duration(500).attr("opacity",1),p.selectAll(".link-line").transition().duration(500).attr("opacity",1)}).call(c.drag).append("circle").attr("class","node-circle").attr("r",n).attr("id",function(e){return"node_"+e.id}).style("fill",function(e){return e.group===1?"#024dd9":"#6c28f7"}),f=p.selectAll(".node").append("text").attr("class","node-label").attr("font-family","Arial, Helvetica, sans-serif").attr("fill","white").style("font","normal 18px Arial").attr("dy",".35em").attr("text-anchor","middle").text(function(e){return e.id}),c.start()},this.tick=function(e){p.selectAll(".node-circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),p.selectAll(".link-line").attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),f.attr("x",function(e){return e.x}).attr("y",function(e){return e.y}),a.attr("x",function(e){return(e.source.x+e.target.x)/2+15}).attr("y",function(e){return(e.source.y+e.target.y)/2+15})}},l=new f;return $(document).on("ready",function(){var e=[];o=1,$("#graph_visualize").hide();for(var t=0;t<20;t++)e.push({id:t});l.buildNodes(e,"tree"),l.refreshGraph()}),$("#graph_build").on("click",function(){var e,t,n=[];o=0,$("#graph_visualize").show(),e=$("#num_nodes").val(),t=$("#graph_type").val();for(var r=0;r<e;r++)n.push({id:r});l.buildNodes(n,t)}),$("#graph_visualize").on("click",function(){console.log(l.inspectLinks()),console.log(l.inspectLinks().length),console.log(o),$("#graph_type").val()==="input"?(l.buildGraphFromInput(),l.inspectLinks().length>s?$("#warning_modal").modal("show"):l.refreshGraph()):o!==1&&($("#graph_visualize").hide(),l.inspectLinks().length>s?$("#warning_modal").modal("show"):(o=1,l.refreshGraph()))}),$("#continue_visualizing").on("click",function(){o=1,l.refreshGraph()}),$("#graph_highlight").on("click",function(){var e;e=$("#highlight_edges").html().replace(/<\/div>/g,"").replace(/\n/g,"").split(/<div[\s\w="-:;]*>/);for(var t=0;t<e.length;t++)e[t].trim(),e[t]={source:e[t].split(" ")[0],target:e[t].split(" ")[1]};l.highlightEdges(e)}),$("#graph_type").on("change",function(){o=0,$(this).val()==="input"?($("#graph_visualize").show(),$(".opt").hide()):$(this).val()==="custom"?($("#graph_visualize").hide(),$(".opt").show(),$(".custom_hide").hide(),$(".custom_opt").show()):($("#graph_visualize").hide(),$(".opt").show(),$(".custom_hide").show(),$(".custom_opt").hide())}),$("#graph_run").on("click",function(){var e=$("#graph_algo").val();l.algo(e)}),$("#graph_algo").on("change",function(){$(this).val()==="dijkstra"?$("#start").closest(".row").show():$("#start").closest(".row").hide()}),l}()