var ui=function(){"use strict";function f(){d3.select(this).select("circle").transition().duration(200).attr("r",n)}var e=$(".graph_cont").width(),t=$(".graph_cont").height(),n=15,r=20,i=d3.scale.category20(),s,o,u=function(r){var s,o,u,a,f,l,c=[],h=[],p=[],d={},v=0,m=-1,g=0,y=0,b=this,w=function(){l.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")},E=d3.behavior.zoom().scaleExtent([.1,2]).on("zoom",w);this.inspectNodes=function(){return h},this.inspectLinks=function(){return p},this.constructForceLayout=function(n){$("svg").remove(),n=typeof n=="undefined"?1:n,a=d3.layout.force().charge(-3e3).linkDistance(200*n).linkStrength(.5).size([e,t]).links(p).nodes(h).on("tick",this.tick),f=d3.select(".graph_cont").append("svg").attr("width",e).attr("height",t).call(E).on("dblclick.zoom",null),l=f.append("g")},this.clearNodes=function(e){h=[],p=[],this.constructForceLayout(e)},this.refreshNodes=function(){$.each(h,function(e,t){t.fixed=!0})},this.neighboring=function(e,t){return console.log(e,t),e===t||d[e+"-"+t]},this.buildLinks=function(e){var t,n;t=parseInt($("#min_w").val()),n=parseInt($("#max_w").val()),c=[];for(var r=0;r<h.length;r++)c.push([]);switch(e){case"tree":var i,s,o=[],u=[];for(var r=1;r<h.length;r++)o.push(h[r]);u.push(h[0]);while(o.length!==0){i=Math.floor(Math.random()*5+1);for(var r=0;r<i;r++){if(!(o.length>0))break;s=Math.floor(Math.random()*(o.length-1)),p.push({source:h[u[0].id],target:h[o[s].id],type:0,weight:Math.floor(Math.random()*n+t)}),c[u[0].id].push(o[s].id),c[o[s].id].push(u[0].id),u.push(o[s]),o.splice(s,1)}u.shift()}break;case"btree":var s,o=[],u=[];for(var r=1;r<h.length;r++)o.push(h[r]);u.push(h[0]);while(o.length!==0){for(var r=0;r<2;r++){if(!(o.length>0))break;s=Math.floor(Math.random()*(o.length-1)),p.push({source:h[u[0].id],target:h[o[s].id],type:0,weight:Math.floor(Math.random()*n+t)}),c[u[0].id].push(o[s].id),c[o[s].id].push(u[0].id),u.push(o[s]),o.splice(s,1)}u.shift()}break;case"sparse":var a,s,f,l,v,m,g,o=[],y;g=h.length,m=Math.floor(Math.random()*(g*(g-1)/4-1-g)+g),v=Math.ceil(m/g),a=m%g;for(var r=0;r<h.length;r++)o.push(h[r]);while(o.length!==0){l=Math.floor(Math.random()*(o.length-1)),f=o[l],o.splice(l,1),y=[];for(var r=0;r<g;r++)c[r].indexOf(f.id)===-1&&y.push(h[r]);for(var r=0;r<v;r++){if(!(y.length>0))break;s=Math.floor(Math.random()*(y.length-1)),p.push({source:h[f.id],target:y[s],type:0,weight:Math.floor(Math.random()*n+t)}),c[f.id].push(y[s].id),c[y[s].id].push(f.id),y.splice(s,1),a--,a==0&&(v--,a=m)}}break;case"dense":var a,s,f,l,v,m,g,o=[],y;g=h.length,m=Math.floor(Math.random()*(g*(g-1)/4-1-g)+g+g*(g-1)/4),v=Math.ceil(m/g),a=m%g;for(var r=0;r<g;r++)o.push(h[r]);while(o.length!==0){l=Math.floor(Math.random()*(o.length-1)),f=o[l],o.splice(l,1),y=[];for(var r=0;r<g;r++)c[r].indexOf(f.id)===-1&&y.push(h[r]);for(var r=0;r<v;r++){if(!(y.length>0))break;s=Math.floor(Math.random()*(y.length-1)),p.push({source:h[f.id],target:y[s],type:0,weight:Math.floor(Math.random()*n+t)}),c[f.id].push(y[s].id),c[y[s].id].push(f.id),y.splice(s,1),a--,a==0&&(v--,a=m)}}break;case"full":for(var r=0;r<h.length;r++)for(var b=r+1;b<h.length;b++)p.push({source:h[r],target:h[b],type:0,weight:Math.floor(Math.random()*n+t)}),c[r].push(b),c[b].push(r);break;default:}$("#graph_data").html(""),$("#graph_data").append("<div>"+h.length+" "+p.length+"</div>"),d={};for(var r=0;r<p.length;r++)d[p[r].source.id+"-"+p[r].target.id]=1,d[p[r].target.id+"-"+p[r].source.id]=1,$("#graph_data").append("<div>"+p[r].source.id+" "+p[r].target.id+" "+p[r].weight+"</div>")},this.buildNodes=function(n,r){var i;m=v,v=0,r==="sparse"?this.clearNodes(2):r==="dense"?this.clearNodes(4):r==="full"?this.clearNodes(8):(n[0].group=1,this.clearNodes());for(var s=0;s<n.length;s++){var o=n[s];o.x=e/2,o.y=t/2,h.push(o)}this.buildLinks(r)},this.refreshGraph=function(){s=l.selectAll(".link"),s=s.data(a.links()),s.enter().append("g").attr("class","link").append("line").attr("class","link-line").attr("stroke-width",3).style("stroke",function(e){return i(e.type)}).call(a.drag),o=f.selectAll(".link").append("text").attr("class","link-label").attr("font-family","Arial, Helvetica, sans-serif").attr("fill","Black").style("font","normal 16px Arial").attr("dy",".35em").attr("text-anchor","middle").text(function(e){return e.weight}),u=l.selectAll(".node"),u=u.data(a.nodes()),u.enter().insert("circle",".cursor").attr("title","hi").attr("class","node").attr("r",n).attr("id",function(e){return"node_"+e.id}).style("fill",function(e){return i(e.group)}).on("mouseover",function(e){l.selectAll(".node").transition().duration(500).attr("opacity",function(t){return b.neighboring(e.id,t.id)?1:.3}),l.selectAll(".link-line").transition().duration(500).attr("opacity",function(t){return t.source.id==e.id||t.target.id==e.id?1:.3})}).on("mouseout",function(){l.selectAll(".node").transition().duration(500).attr("opacity",1),l.selectAll(".link-line").transition().duration(500).attr("opacity",1)}).call(a.drag),a.start()},this.tick=function(e){u.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),l.selectAll(".link-line").attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),o.attr("x",function(e){return(e.source.x+e.target.x)/2+15}).attr("y",function(e){return(e.source.y+e.target.y)/2+15})}},a=new u;return $(document).on("ready",function(){var e=[];for(var t=0;t<20;t++)e.push({id:t});a.buildNodes(e,"tree"),a.refreshGraph()}),$("#graph_submit").on("click",function(){var e,t,n=[];e=$("#num_nodes").val(),t=$("#graph_type").val();for(var r=0;r<e;r++)n.push({id:r});a.buildNodes(n,t),a.refreshGraph()}),a}()