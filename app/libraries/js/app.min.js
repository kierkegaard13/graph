var ui=function(){"use strict";var e=$(".graph_cont").width(),t=$(".graph_cont").height(),n=15,r=20,i=d3.scale.category20(),s=1e3,o=0,u,a,f=function(r){var s,u,a,f,l,c,h=[],p=[],d=[],v=[],m={},g=0,y=-1,b=0,w=0,E=this,S=function(){c.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")},x=d3.behavior.zoom().scaleExtent([.1,2]).on("zoom",S);this.inspectNodes=function(){return d},this.inspectLinks=function(){return v},this.constructForceLayout=function(n){$("svg").remove(),n=typeof n=="undefined"?1:n,f=d3.layout.force().charge(-6e3).linkDistance(200*n).linkStrength(.2).size([e,t]).links(v).nodes(d).on("tick",this.tick),l=d3.select(".graph_cont").append("svg").attr("width",e).attr("height",t).call(x).on("dblclick.zoom",null),c=l.append("g")},this.clearNodes=function(e){d=[],v=[],this.constructForceLayout(e)},this.refreshNodes=function(){$.each(d,function(e,t){t.fixed=!0})},this.neighboring=function(e,t){return console.log(e,t),e===t||m[e+"-"+t]},this.buildLinks=function(e){var t,n;t=parseInt($("#min_w").val()),n=parseInt($("#max_w").val()),p=[];for(var r=0;r<d.length;r++)p.push([]);switch(e){case"tree":var i,s,o=[],u=[];for(var r=1;r<d.length;r++)o.push(d[r]);u.push(d[0]);while(o.length!==0){i=Math.floor(Math.random()*5+1);for(var r=0;r<i;r++){if(!(o.length>0))break;s=Math.floor(Math.random()*(o.length-1)),v.push({source:d[u[0].id],target:d[o[s].id],type:0,weight:Math.floor(Math.random()*n+t)}),p[u[0].id].push(o[s].id),p[o[s].id].push(u[0].id),u.push(o[s]),o.splice(s,1)}u.shift()}break;case"btree":var s,o=[],u=[];for(var r=1;r<d.length;r++)o.push(d[r]);u.push(d[0]);while(o.length!==0){for(var r=0;r<2;r++){if(!(o.length>0))break;s=Math.floor(Math.random()*(o.length-1)),v.push({source:d[u[0].id],target:d[o[s].id],type:0,weight:Math.floor(Math.random()*n+t)}),p[u[0].id].push(o[s].id),p[o[s].id].push(u[0].id),u.push(o[s]),o.splice(s,1)}u.shift()}break;case"sparse":var a,s,f,l,c,h,g,o=[],y;g=d.length,h=Math.floor(Math.random()*(g*(g-1)/4-1-g)+g),c=Math.ceil(h/g),a=h%g;for(var r=0;r<d.length;r++)o.push(d[r]);while(o.length!==0){l=Math.floor(Math.random()*(o.length-1)),f=o[l],o.splice(l,1),y=[];for(var r=0;r<g;r++)p[r].indexOf(f.id)===-1&&y.push(d[r]);for(var r=0;r<c;r++){if(!(y.length>0))break;s=Math.floor(Math.random()*(y.length-1)),v.push({source:d[f.id],target:y[s],type:0,weight:Math.floor(Math.random()*n+t)}),p[f.id].push(y[s].id),p[y[s].id].push(f.id),y.splice(s,1),a--,a==0&&(c--,a=h)}}break;case"dense":var a,s,f,l,c,h,g,o=[],y;g=d.length,h=Math.floor(Math.random()*(g*(g-1)/4-1-g)+g+g*(g-1)/4),c=Math.ceil(h/g),a=h%g;for(var r=0;r<g;r++)o.push(d[r]);while(o.length!==0){l=Math.floor(Math.random()*(o.length-1)),f=o[l],o.splice(l,1),y=[];for(var r=0;r<g;r++)p[r].indexOf(f.id)===-1&&y.push(d[r]);for(var r=0;r<c;r++){if(!(y.length>0))break;s=Math.floor(Math.random()*(y.length-1)),v.push({source:d[f.id],target:y[s],type:0,weight:Math.floor(Math.random()*n+t)}),p[f.id].push(y[s].id),p[y[s].id].push(f.id),y.splice(s,1),a--,a==0&&(c--,a=h)}}break;case"full":for(var r=0;r<d.length;r++)for(var b=r+1;b<d.length;b++)v.push({source:d[r],target:d[b],type:0,weight:Math.floor(Math.random()*n+t)}),p[r].push(b),p[b].push(r);break;case"custom":var w,E=parseFloat($("#prob").val());for(var r=0;r<d.length;r++)for(var b=r+1;b<d.length;b++)w=Math.random()<E,w===!0&&(v.push({source:d[r],target:d[b],type:0,weight:Math.floor(Math.random()*n+t)}),p[r].push(b),p[b].push(r));break;case"input":break;default:}$("#graph_data").html(""),$("#graph_data").append("<div>"+d.length+" "+v.length+"</div>"),m={};for(var r=0;r<v.length;r++)m[v[r].source.id+"-"+v[r].target.id]=1,m[v[r].target.id+"-"+v[r].source.id]=1,$("#graph_data").append("<div>"+v[r].source.id+" "+v[r].target.id+" "+v[r].weight+"</div>")},this.buildNodes=function(n,r){var i;y=g,g=0,r==="sparse"?this.clearNodes(2):r==="dense"?this.clearNodes(4):r==="full"?this.clearNodes(8):(n[0].group=1,this.clearNodes());for(var s=0;s<n.length;s++){var o=n[s];o.x=e/2,o.y=t/2,d.push(o)}this.buildLinks(r)},this.buildGraphFromInput=function(){var n,r,i,s=$("#graph_data").html();o=1,s=s.replace(/<\/div>/g,"").split(/<div[\s\w="-:;]*>/),s[0]===""&&s.splice(0,1),n=parseInt(s[0].split(" ")[0]),r=parseInt(s[0].split(" ")[1]),p=[];for(var u=0;u<n;u++)p.push([]);n<50?this.clearNodes():n<100?this.clearNodes(2):n<500?this.clearNodes(4):this.clearNodes(8);for(var u=0;u<n;u++)d.push({id:u,x:e/2,y:t/2});for(var u=1;u<=r;u++)s[u].length>0&&(s[u].trim(),i=s[u].split(" "),i={source:parseInt(i[0]),target:parseInt(i[1]),weight:parseFloat(i[2])},p[i.source].push(i.target),p[i.target].push(i.source),v.push({source:d[i.source],target:d[i.target],type:0,weight:i.weight}),m={},m[i.source+"-"+i.target]=1,m[i.target+"-"+i.source]=1)},this.findEdge=function(e,t){var n=null;e=parseInt(e),t=parseInt(t);for(var r=0;r<v.length;r++){if(v[r].source.id===e&&v[r].target.id===t)return n=v[r],{dom:$("#link_"+e+"_"+t),item:n};if(v[r].source.id===t&&v[r].target.id===e)return n=v[r],{dom:$("#link_"+t+"_"+e),item:n}}return null},this.highlightEdge=function(e,t){var n=$("#link_"+e+"_"+t);n.length===0&&(n=$("#link_"+t+"_"+e)),n.find(".link-line").css("stroke","red")},this.highlightEdges=function(e){var t;for(var n=h.length-1;n>=0;n--)t=this.findEdge(h[n].source,h[n].target),t&&t.dom.find(".link-line").css("stroke",i(t.item.type)),h.pop();for(var n=0;n<e.length;n++)this.highlightEdge(e[n].source,e[n].target),h.push(e[n])},this.refreshGraph=function(){s=c.selectAll(".link"),s=s.data(f.links()),s.enter().append("g").attr("class","link").attr("id",function(e){return"link_"+e.source.id+"_"+e.target.id}).append("line").attr("class","link-line").attr("stroke-width",3).style("stroke",function(e){return i(e.type)}).call(f.drag),u=l.selectAll(".link").append("text").attr("class","link-label").attr("font-family","Arial, Helvetica, sans-serif").attr("fill","Black").style("font","normal 16px Arial").attr("dy",".35em").attr("text-anchor","middle").text(function(e){return e.weight}),a=c.selectAll(".node"),a=a.data(f.nodes()),a.enter().insert("circle",".cursor").attr("title","hi").attr("class","node").attr("r",n).attr("id",function(e){return"node_"+e.id}).style("fill",function(e){return i(e.group)}).on("mouseover",function(e){c.selectAll(".node").transition().duration(500).attr("opacity",function(t){return E.neighboring(e.id,t.id)?1:.3}),c.selectAll(".link-line").transition().duration(500).attr("opacity",function(t){return t.source.id==e.id||t.target.id==e.id?1:.3})}).on("mouseout",function(){c.selectAll(".node").transition().duration(500).attr("opacity",1),c.selectAll(".link-line").transition().duration(500).attr("opacity",1)}).call(f.drag),f.start()},this.tick=function(e){a.attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}),c.selectAll(".link-line").attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y}),u.attr("x",function(e){return(e.source.x+e.target.x)/2+15}).attr("y",function(e){return(e.source.y+e.target.y)/2+15})}},l=new f;return $(document).on("ready",function(){var e=[];o=1,$("#graph_visualize").hide();for(var t=0;t<20;t++)e.push({id:t});l.buildNodes(e,"tree"),l.refreshGraph()}),$("#graph_build").on("click",function(){var e,t,n=[];o=0,$("#graph_visualize").show(),e=$("#num_nodes").val(),t=$("#graph_type").val();for(var r=0;r<e;r++)n.push({id:r});l.buildNodes(n,t)}),$("#graph_visualize").on("click",function(){console.log(l.inspectLinks()),console.log(l.inspectLinks().length),console.log(o),$("#graph_type").val()==="input"?(l.buildGraphFromInput(),l.inspectLinks().length>s?$("#warning_modal").modal("show"):l.refreshGraph()):o!==1&&($("#graph_visualize").hide(),l.inspectLinks().length>s?$("#warning_modal").modal("show"):(o=1,l.refreshGraph()))}),$("#continue_visualizing").on("click",function(){o=1,l.refreshGraph()}),$("#graph_highlight").on("click",function(){var e;e=$("#highlight_edges").html().replace(/<\/div>/g,"").replace(/\n/g,"").split(/<div[\s\w="-:;]*>/);for(var t=0;t<e.length;t++)e[t].trim(),e[t]={source:e[t].split(" ")[0],target:e[t].split(" ")[1]};l.highlightEdges(e)}),$("#graph_type").on("change",function(){o=0,$(this).val()==="input"?($("#graph_visualize").show(),$(".opt").hide()):$(this).val()==="custom"?($("#graph_visualize").hide(),$(".opt").show(),$(".custom_hide").hide(),$(".custom_opt").show()):($("#graph_visualize").hide(),$(".opt").show(),$(".custom_hide").show(),$(".custom_opt").hide())}),l}()